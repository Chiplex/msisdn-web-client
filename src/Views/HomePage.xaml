<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:MSISDNWebClient.ViewModels"
             x:Class="MSISDNWebClient.Views.HomePage"
             x:DataType="vm:HomeViewModel"
             BackgroundColor="Black"
             Shell.NavBarIsVisible="False">

    <Grid RowDefinitions="Auto,*,Auto">

        <!-- Header con pestaÃ±as tipo TikTok -->
        <Grid Grid.Row="0"
              Padding="0"
              BackgroundColor="#1a1a1a"
              HeightRequest="50">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- PestaÃ±a PÃºblico -->
            <Border Grid.Column="0"
                    BackgroundColor="Transparent"
                    Padding="0">
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding SelectPublicTabCommand}" />
                </Border.GestureRecognizers>
                <VerticalStackLayout Spacing="5"
                                    VerticalOptions="Center">
                    <Label Text="PÃºblico"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="{Binding IsPublicTab, Converter={StaticResource BoolToTabColorConverter}}"
                           HorizontalTextAlignment="Center" />
                    <BoxView HeightRequest="3"
                             BackgroundColor="White"
                             IsVisible="{Binding IsPublicTab}"
                             HorizontalOptions="Center"
                             WidthRequest="60" />
                </VerticalStackLayout>
            </Border>

            <!-- PestaÃ±a Mis Contactos -->
            <Border Grid.Column="1"
                    BackgroundColor="Transparent"
                    Padding="0">
                <Border.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding SelectContactsTabCommand}" />
                </Border.GestureRecognizers>
                <VerticalStackLayout Spacing="5"
                                    VerticalOptions="Center">
                    <Label Text="Mis contactos"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="{Binding IsPublicTab, Converter={StaticResource InvertedBoolToTabColorConverter}}"
                           HorizontalTextAlignment="Center" />
                    <BoxView HeightRequest="3"
                             BackgroundColor="White"
                             IsVisible="{Binding IsPublicTab, Converter={StaticResource InvertedBoolConverter}}"
                             HorizontalOptions="Center"
                             WidthRequest="60" />
                </VerticalStackLayout>
            </Border>
        </Grid>

        <!-- Contenido principal con CarouselView para scroll horizontal -->
        <CarouselView Grid.Row="1"
                      ItemsSource="{Binding DisplayedProfiles}"
                      CurrentItem="{Binding CurrentProfile}"
                      IsScrollAnimated="True"
                      Loop="False"
                      PeekAreaInsets="0">
            <CarouselView.ItemTemplate>
                <DataTemplate>
                    <Grid BackgroundColor="Black">
                        <ScrollView>
                            <VerticalStackLayout Padding="0"
                                                Spacing="0">
                                
                                <!-- Avatar y nombre -->
                                <VerticalStackLayout Padding="20,30,20,10"
                                                    Spacing="10">
                                    <Image Source="{Binding AvatarUrl, TargetNullValue='dotnet_bot.png'}"
                                           HeightRequest="100"
                                           WidthRequest="100"
                                           Aspect="AspectFill"
                                           HorizontalOptions="Center">
                                        <Image.Clip>
                                            <EllipseGeometry Center="50,50"
                                                           RadiusX="50"
                                                           RadiusY="50" />
                                        </Image.Clip>
                                    </Image>

                                    <Label Text="{Binding DisplayName}"
                                           FontSize="24"
                                           FontAttributes="Bold"
                                           TextColor="White"
                                           HorizontalTextAlignment="Center" />
                                    
                                    <Label Text="{Binding PersonaIdShort}"
                                           FontSize="12"
                                           TextColor="#888888"
                                           FontFamily="Monospace"
                                           HorizontalTextAlignment="Center" />
                                </VerticalStackLayout>

                                <!-- Contenido HTML personalizado -->
                                <WebView HeightRequest="600"
                                         Margin="10,20">
                                    <WebView.Source>
                                        <HtmlWebViewSource Html="{Binding HtmlContent}" />
                                    </WebView.Source>
                                </WebView>

                            </VerticalStackLayout>
                        </ScrollView>

                        <!-- Indicador de swipe -->
                        <Label Text="â† Desliza â†’"
                               FontSize="12"
                               TextColor="#444444"
                               HorizontalOptions="Center"
                               VerticalOptions="End"
                               Margin="0,0,0,80" />
                    </Grid>
                </DataTemplate>
            </CarouselView.ItemTemplate>
        </CarouselView>

        <!-- MenÃº de navegaciÃ³n inferior -->
        <Grid Grid.Row="2"
              BackgroundColor="#1a1a1a"
              HeightRequest="60"
              Padding="10,5">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Inicio -->
            <VerticalStackLayout Grid.Column="0"
                                Spacing="2">
                <VerticalStackLayout.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding GoToHomeCommand}" />
                </VerticalStackLayout.GestureRecognizers>
                <Label Text="ðŸ "
                       FontSize="24"
                       HorizontalTextAlignment="Center" />
                <Label Text="Inicio"
                       FontSize="10"
                       TextColor="White"
                       HorizontalTextAlignment="Center" />
            </VerticalStackLayout>

            <!-- Notificaciones -->
            <VerticalStackLayout Grid.Column="1"
                                Spacing="2">
                <VerticalStackLayout.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding GoToExplorerCommand}" />
                </VerticalStackLayout.GestureRecognizers>
                <Label Text="ðŸ””"
                       FontSize="24"
                       HorizontalTextAlignment="Center" />
                <Label Text="Notificaciones"
                       FontSize="10"
                       TextColor="White"
                       HorizontalTextAlignment="Center" />
            </VerticalStackLayout>

            <!-- Perfil -->
            <VerticalStackLayout Grid.Column="2"
                                Spacing="2">
                <VerticalStackLayout.GestureRecognizers>
                    <TapGestureRecognizer Command="{Binding GoToProfileCommand}" />
                </VerticalStackLayout.GestureRecognizers>
                <Label Text="ðŸ‘¤"
                       FontSize="24"
                       HorizontalTextAlignment="Center" />
                <Label Text="Perfil"
                       FontSize="10"
                       TextColor="White"
                       HorizontalTextAlignment="Center" />
            </VerticalStackLayout>

        </Grid>

        <!-- Indicador de carga -->
        <ActivityIndicator Grid.Row="1"
                          IsRunning="{Binding IsBusy}"
                          Color="White"
                          HeightRequest="40"
                          VerticalOptions="Center"
                          HorizontalOptions="Center" />

    </Grid>

</ContentPage>
