<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:MSISDNWebClient.ViewModels"
             x:Class="MSISDNWebClient.Views.OnboardingPage"
             x:DataType="vm:OnboardingViewModel"
             BackgroundColor="{StaticResource PageBackground}">

    <ScrollView>
        <VerticalStackLayout Padding="30"
                            Spacing="20">

            <Label Text="Crear tu Identidad"
                   Style="{StaticResource TitleStyle}"
                   Margin="0,20,0,0" />

            <Label Text="Ingresa tu número móvil para generar tu PersonaID único y descentralizado"
                   Style="{StaticResource SubtitleStyle}" />

            <!-- Entrada MSISDN -->
            <Frame Style="{StaticResource CardStyle}">
                <VerticalStackLayout Spacing="15">
                    
                    <Label Text="Número de teléfono (MSISDN)"
                           FontSize="14"
                           FontAttributes="Bold"
                           TextColor="{StaticResource TextPrimary}" />

                    <Entry Text="{Binding Msisdn}"
                           Placeholder="+34612345678"
                           Keyboard="Telephone"
                           FontSize="16"
                           TextColor="{StaticResource TextPrimary}" />

                    <Button Text="Enviar Código OTP"
                            Command="{Binding RequestOTPCommand}"
                            IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}"
                            Style="{StaticResource PrimaryButtonStyle}" />

                    <Label Text="{Binding OtpMessage}"
                           IsVisible="{Binding IsOtpSent}"
                           FontSize="12"
                           TextColor="{StaticResource Success}"
                           HorizontalTextAlignment="Center" />
                    
                </VerticalStackLayout>
            </Frame>

            <!-- Entrada OTP -->
            <Frame Style="{StaticResource CardStyle}"
                   IsVisible="{Binding IsOtpSent}">
                <VerticalStackLayout Spacing="15">
                    
                    <Label Text="Código de Verificación"
                           FontSize="14"
                           FontAttributes="Bold"
                           TextColor="{StaticResource TextPrimary}" />

                    <Entry Text="{Binding OtpCode}"
                           Placeholder="123456"
                           Keyboard="Numeric"
                           MaxLength="6"
                           FontSize="20"
                           HorizontalTextAlignment="Center"
                           TextColor="{StaticResource TextPrimary}" />

                    <Button Text="Verificar y Crear Identidad"
                            Command="{Binding VerifyOTPCommand}"
                            IsEnabled="{Binding CanVerify}"
                            Style="{StaticResource PrimaryButtonStyle}" />
                    
                </VerticalStackLayout>
            </Frame>

            <!-- Mensaje de error -->
            <Label Text="{Binding ErrorMessage}"
                   IsVisible="{Binding HasError}"
                   TextColor="{StaticResource Error}"
                   FontSize="12"
                   HorizontalTextAlignment="Center"
                   Margin="0,10,0,0" />

            <!-- Indicador de carga -->
            <ActivityIndicator IsRunning="{Binding IsBusy}"
                              Color="{StaticResource Primary}"
                              HeightRequest="40" />

            <!-- Info adicional -->
            <Frame Style="{StaticResource InfoCardStyle}"
                   Margin="0,20,0,0">
                <VerticalStackLayout Spacing="10">
                    <Label Text="¿Qué es PersonaID?"
                           FontSize="16"
                           FontAttributes="Bold"
                           TextColor="{StaticResource TextPrimary}" />
                    
                    <Label Text="Es tu identidad digital única generada mediante criptografía (SHA-256) a partir de tu número móvil. No se almacena en ningún servidor central."
                           FontSize="12"
                           TextColor="{StaticResource TextSecondary}"
                           LineBreakMode="WordWrap" />
                </VerticalStackLayout>
            </Frame>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>
